
2021/04/06(Tue.)
ascan.cpp (+ fft.cpp, wave1d.cpp, waves.h)
	A-scope波形に対する種々の操作
	新たにSigmoid関数による波形切り出し操作を追加

	動作確認: reference signalと透過波データが必要
	出力ファイル

		ref0.out(参照波形)
		ref1.out(参照波形×Window) 
	
		wv0.out(透過波形)
		wv1.out(透過波形×Window）
		wv1.fft(FFTスペクトル：極座標)

		cp.dat（位相速度）
mw.py
	Fractional Voigtモデルによるslowness sp(w)のフィッティング
	s0は線形最小二乗法で決定。
	betaは囲い込み後に解を黄金分割法で精度改善
	実行にはascan.cppからの出力cp.datが必要(slownessのデータを指定した周波数範囲で利用)
	周波数の刻みcp.datに合わせられる

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2021/04/07(Wed.)
ascan.cpp
	Voigt クラスを追加
		Fractional Voigtモデルのcomplex modulusと大きさ、偏角、slownessを計算
		メンバ変数に計測波形から求めたslownessを持つ
		s_mdl(モデル),s_msd(実験)*s0がそれぞれslownessを表す。
		両者の差を取ることでコストを計算。
		コストをbetaについて最小化するメンバー関数を作成

	-->　alph(exponent)は大抵1.0が最適(つまり普通のVoigt)
	--> betaを最適化しても実験で得たスローネスの細かい変動は表現できない
		（Voigtモデルはslownessが周波数に対して単調に変化する)

	sp.datの内容は
		frequency, slowness(measured), slowness(model), phase vel.(measured), phase vel.(model)
		
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2021/04/08(Thu.)
ascan.cpp 不要部分を削除
	出力ファイル cp.datは廃止（sp.datに指定した周波数範囲の位相速度等が書き出される)
	sp.datの内容は
	 Col 1     COL2                COL3             COL4                  COL5               COL6
	frequency, slowness(measured), slowness(model), phase vel.(measured), phase vel.(model), Im(s)(model))
		
Pycodes/cp_hist.py
	cp.hist(<-- bscan.cppの出力)
	位相速度のヒスグラムをcolormap表示
	** mw.py がGit管理下に置かれていなかった。see memo taken on th6 of April. 

bscan.cpp, ascan.cpp
	pythonで計算(stats.py + kw.py)で計算した位相速度と結果が合わない!

	The range of np.angle() & arg(complex<double>) is both [-pi, pi].
	--> modified to [0,2pi] by th=2pi+th ( when th<0). 

	原因はWindowのかけ方かと思い調べているが現状では原因不明。
	Sigmoid + ゆるいGaussianWindow +　tight なGaussian の組で窓をかけると、
	右肩上がりの結果が全ての鉱物種について現れる。これは明らかに窓関数によるバイアス
	で意味の無い結果と思われる。
	--> Possible source of error is zero padding in FFT. 
	    How python FFT works with data of non 2^p length has not been checked.
	    Is simple zero padding is OK ?  Need to be cheked.

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2021/04/09(Fri.)
ascan.cppとkw.pyの結果の違いについて
	原因解明: ascan.cpp-wave1d.cppに誤り 
		Wv1D::Gauss()で、標準偏差sigで引数を割るのを忘れていた。
		Gauss窓の幅が意図した通りにはなっていなかった
		(debuggingの方法：参照波形のA-scanと周波数スペクトルを
		kw.pyとascan.cppで比較、窓関数をかけた後の波形が異なることが判明）


	kw.py 波形のload時に振幅を2倍していた(単位を速度にするための換算係数）
	ややこしいのでそのまま(1倍)にしておくことに。

	bscan.cpp+Pycodes/cp_hist.pyでヒストグラムのカラーマップは概ね一致することを確認
	FFT with zero padding was found to give correct spectrum. 

	Next:
	* ascan.cppの整理(不要部分を削除してslimにする)
	* bscan.cppも同じ
	* 窓関数のかけ方を正当化するための論拠(窓関数パラメータ設定の合理化、理由付けagain)
	* viscoelastic complex modulus M(w)でのfitting (Maxwell modelも検討すべきか？）
	* 平均的なcp(w)と外れ値の比較,原因究明
	* M(w) parameterの分布

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2021/04/10(Sat.)
	* ascan.cpp
	Voigt class in "ascan.cpp" --> separated from ascan.cpp to voigt.h and voigt.cpp
	Least square fitting of cp (measured phase velocity) 
		--> Voigt::linfit_cp(double *a, double *b); 
			cp(freq.) = a x (frequency) + b 
	cp(位相速度)の直線近似-->平均値と勾配を評価（cp-f curve分類の1st attempt)

	* bscan.cpp
	Voigtクラスを使って、位相速度を直線近似
	--> linfit.outに結果を書き出し(a,b,cp_mean)
	--> ../Pycodes/linfit_hist.pyでヒストグラムを表示

	cpの周波数に対する勾配 正負両方のケースがある(ダンパーを含むようなModulusでは負の傾きが出せない)
	Cole-Cole typeの使用が必要？ --> CC typeでもModululsの大きさは増加
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2021/04/16 (Fri.)
	k(w)=phase/h (wave number)をvisco elastic modulusで近似する(plan)
	k(w)はeta(viscosity)による影響が曲率に出るが、実験結果の方の
	k(w)hの曲率が微妙でfittingにどれくらい意味があるか自信が持てない.	
	もっと確実かつ、全体像を掴むことができる類型化(classification
	の方法が無いか？？
2021/04/17(Sat.)
	c(w)= a x w +b (regression) 
	 i) a<0: S/Nがよい、低周波側でk-wの傾きが小さい（下に凸)
	ii) a>0: S/Nが悪い、低周波側でk-wの傾きが直線的あるいは上に凸
		--> 振幅(S/N）の情報を使っていない(減衰の評価を諦めたため。同一鉱物種での相対評価は可能)
	 (a,<c>) のscatter plotには負の相関がある。
	 鉱物種による差がある。平均波形からの偏差を時間波形から直接定量化する方が説得力があるかも知れない。

	voigt.h, voigt.cpp: linfit_cp をvoid からdoubleに変更(位相速度の平均値を戻す)
	
2021/04/28 (Wed.)
	bscan.cpp > Wv2D::*amp_mean <-- all waveforms stacked  (coded before, but has not been noteed)
		In "Wv2D::load(...)"
			1. memory allocatted,
			2. data loaded, 
			3. exported to File "amp_mean_*.dat" where * is mineral type, one of {Qt,Na,Fe}

	mean_awv.cpp ( mean_awv.o + fft.o + wave1d.o)
		used to investigate mean wave frequency spectrum
		--> wv.t (mean A-scan, Gaussian filtered)
		--> wv.f (mean A-scan, filtered, FFT)
		--> wv2.t (A-scan, raw data)
		とりあえず、以上のファイル名で出力して結果を確認
	到達が明らかに速いものがある。
	減衰振動波形は、多重反射によるもの．
	中には平均波形に非常に近いかたちものもある（当然か...)
	以上Quartzのデータで2,3表示したときの話．

	平均波形のunwrapした位相スペクトがおかしい(unwrapされていないような形)
	-->個別の波形の位相スペクトルも見てみる。プログラム上の問題かどうかを確認するために
	
		

	

